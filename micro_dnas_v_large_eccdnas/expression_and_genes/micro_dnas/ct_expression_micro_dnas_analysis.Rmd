---
title: "ct_expression_micro_dnas_analysis"
output: html_document
---



```{r}

library(data.table)
library(ggplot2)
library(scales)

df_rpkm <- data.frame(fread('G3.RPKMvsSRs'))

colnames(df_rpkm) <- c("gene", "rpkm", "srs")

df_rpkm <- df_rpkm[df_rpkm$srs != 0 & df_rpkm$rpkm != 0,]

df_rpkm$rpkm <- log10(df_rpkm$rpkm)

df_rpkm$srs <- log10(df_rpkm$srs)

cor_test <- cor.test(df_rpkm$rpkm, df_rpkm$srs, method=c("pearson"))
cor <-  round(cor_test$estimate[[1]], digits = 4)
pvalue <- round(cor_test$p.value[[1]], digits = 4)

p <- ggplot(df_rpkm, aes(x=rpkm, y=srs)) +
    stat_density_2d(aes(fill = ..level..), geom = "polygon") +
    labs(x="Log 10 RPKM", y="Log 10 junction split \nreads per gene") + theme_classic() +
    labs(fill = "Gene density")+
    geom_smooth(method='lm', color='red')+
    labs(title=paste("Pearson's correlation = ", cor, ", p-value = ", pvalue, sep=''))+
    theme(axis.text=element_text(size=6), axis.title=element_text(size=8), legend.title=element_text(size=8), legend.text=element_text(size=6), 
          plot.title=element_text(size=8, hjust=0.5))


p

ggsave("ct_expression_micro_dnas_rpkm_plot.pdf", plot = p, width = 6.5, height = 3)

```


```{r}
df_rpkm <- data.frame(fread('G3.RPKMvsSRs'))

colnames(df_rpkm) <- c("gene", "rpkm", "srs")

df_rpkm$rank_rpkm <- rank(df_rpkm$rpkm)
df_rpkm$rank_srs <- rank(df_rpkm$srs)

cor_test <- cor.test(df_rpkm$rpkm, df_rpkm$srs, method=c("kendall"))
cor <-  round(cor_test$estimate[[1]], digits = 4)
pvalue <- round(cor_test$p.value[[1]], digits = 4)


p <- ggplot(df_rpkm, aes(x=rank_rpkm, y=rank_srs)) +
    stat_density_2d(aes(fill = ..level..), geom = "polygon") +
    labs(x="Rank RPKM", y="Rank junction split \nreads per gene") + theme_classic() +
    labs(fill = "Gene density")+
    geom_abline(intercept=0, slope=1, linetype=3)+
    labs(title=paste("Spearman's rank correlation = ", cor, ", p-value = ", pvalue, sep=''))+
    theme(axis.text=element_text(size=6), axis.title=element_text(size=8), legend.title=element_text(size=8), legend.text=element_text(size=6), 
          plot.title=element_text(size=8, hjust=0.5))


p



```




```{r}
cor.test(df_rpkm$rpkm, df_rpkm$srs, method=c("spearman"))
```

```{r}
summary(lm(df_rpkm$srs ~ df_rpkm$rpkm))
```

```{r}
par(mfrow=c(2,2))
plot(lm(df_rpkm$srs ~ df_rpkm$rpkm))

pdf(file = "ct_expression_micro_dnas_rpkm_diagnostics.pdf", width = 6, height = 4)
par(mfrow=c(2,2))
plot(lm(df_rpkm$srs ~ df_rpkm$rpkm))
dev.off()
```


```{r}
df_genesper100kb <- data.frame(fread('G3.SRsvsgenesper100kb'))

colnames(df_genesper100kb) <- c("scaffold", "start", "end", "gene_count", "srs")

cor_test <- cor.test(df_genesper100kb$gene_count, df_genesper100kb$srs, method=c("pearson"))
cor <-  round(cor_test$estimate[[1]], digits = 4)
pvalue <- round(cor_test$p.value[[1]], digits = 4)

p <- ggplot(df_genesper100kb, aes(x=gene_count, y=srs)) +
    geom_point() +
    labs(x="Genes per 100kb", y="Junction split reads per 100kb") + theme_classic() +
    geom_smooth(method='lm', color='red')+
    labs(title=paste("Pearson's correlation = ", cor, ", p-value = ", pvalue, sep=''))+
    theme(axis.text=element_text(size=6), axis.title=element_text(size=8), legend.title=element_text(size=8), legend.text=element_text(size=6), 
          plot.title=element_text(size=8, hjust=0.5))


p

ggsave("ct_expression_micro_dnas_genesperk100kb_plot.pdf", plot = p, width = 6.5, height = 3)
```

```{r}

df_genesper100kb <- data.frame(fread('G3.SRsvsgenesper100kb'))

colnames(df_genesper100kb) <- c("scaffold", "start", "end", "gene_count", "srs")

df_genesper100kb$rank_gene_count <- rank(df_genesper100kb$gene_count)
df_genesper100kb$rank_srs <- rank(df_genesper100kb$srs)


cor_test <- cor.test(df_genesper100kb$gene_count, df_genesper100kb$srs, method=c("spearman"))
cor <-  round(cor_test$estimate[[1]], digits = 4)
pvalue <- round(cor_test$p.value[[1]], digits = 4)


p <- ggplot(df_genesper100kb, aes(x=rank_gene_count, y=rank_srs)) +
    geom_point()+
    # stat_density_2d(aes(fill = ..level..), geom = "polygon") +
    labs(x="Rank genes per 100kb", y="Rank junction split \nreads per 100kb") + theme_classic() +
    labs(fill = "Gene density")+
    geom_abline(intercept=0, slope=1, linetype=3)+
    labs(title=paste("Spearman's rank correlation = ", cor, ", p-value = ", pvalue, sep=''))+
    theme(axis.text=element_text(size=6), axis.title=element_text(size=8), legend.title=element_text(size=8), legend.text=element_text(size=6), 
          plot.title=element_text(size=8, hjust=0.5))


p
```


```{r}
cor.test(df_genesper100kb$gene_count, df_genesper100kb$srs, method=c("spearman"))

```

```{r}
summary(lm(df_genesper100kb$srs ~ df_genesper100kb$gene_count))

```

```{r}
par(mfrow=c(2,2))
plot(lm(df_genesper100kb$srs ~ df_genesper100kb$gene_count))

pdf(file = "ct_expression_micro_dnas_genesper100kb_diagnostics.pdf", width = 6, height = 4)
par(mfrow=c(2,2))
plot(lm(df_genesper100kb$srs ~ df_genesper100kb$gene_count))
dev.off()
```


```{r}
df_genesperscaffold <- data.frame(fread('G3.SRsvsgenesperk100kbperscaffold'))

colnames(df_genesperscaffold) <- c("scaffold", "gene_count", "srs")

df_genesperscaffold <- df_genesperscaffold[df_genesperscaffold$srs != 0 & df_genesperscaffold$gene_count != 0,]

df_genesperscaffold$srs <- log10(df_genesperscaffold$srs)

p <- ggplot(df_genesperscaffold, aes(x=gene_count, y=srs)) + geom_point() + geom_smooth(method='lm', color='red') +
    labs(x="Genes per scaffold",
       y="Log10 junction split \nreads per scaffold") + theme_classic()

p

ggsave("ct_expression_micro_dnas_genesperk100kbperscaffold_plot.pdf", plot = p, width = 6, height = 4)
```

```{r}
cor.test(df_genesperscaffold$gene_count, df_genesperscaffold$srs, method=c("pearson"))

```


```{r}
summary(lm(df_genesperscaffold$srs ~ df_genesperscaffold$gene_count))

```

```{r}
par(mfrow=c(2,2))
plot(lm(df_genesperscaffold$srs ~ df_genesperscaffold$gene_count))

pdf(file = "ct_expression_micro_dnas_genesperk100kbperscaffold_diagnostics.pdf", width = 6, height = 4)
par(mfrow=c(2,2))
plot(lm(df_genesperscaffold$srs ~ df_genesperscaffold$gene_count))
dev.off()
```



